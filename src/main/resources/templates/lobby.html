<!DOCTYPE html>
<html lang="ro">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Online</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="stylesheet" href="/css/lobby.css">
</head>

<body>

    <div class="lobby">
        <div class="top-bar">
            <button id="openCreateModal" class="create-btn"><i class="fa-solid fa-plus"></i> Create Room</button>
        </div>
        <div class="rooms" id="roomsList"></div>
    </div>

    <div id="createModal" class="overlay">
        <div class="modal">
            <h3>Create Room</h3>
            <input id="roomPassword" type="text" placeholder="Password (optional)">
            <div>
                <button id="createRoomBtn" class="confirm"><i class="fa-solid fa-arrow-right"></i></button>
                <button id="closeCreateModal" class="cancel"><i class="fa-solid fa-x"></i></button>
            </div>
        </div>
    </div>

    <div id="passwordModal" class="overlay">
        <div class="modal">
            <h3>Enter Room Password</h3>
            <input id="passwordInput" type="password" placeholder="Password">
            <div>
                <button id="confirmPassword" class="confirm"><i class="fa-solid fa-arrow-right"></i></button>
                <button id="cancelPassword" class="cancel"><i class="fa-solid fa-x"></i></button>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        const playerId = /*[[${playerId}]]*/ 0;
    </script>

    <script src="/js/ws.js"></script>
    <script src="/js/lobby.js"></script>

    <script>
        const lobby = new Lobby(playerId, { rooms: renderRooms });

        let pendingRoomId = null;
        const passwordModal = document.getElementById("passwordModal");
        const passwordInput = document.getElementById("passwordInput");

        document.getElementById("cancelPassword").onclick = () => {
            passwordModal.style.display = "none";
            pendingRoomId = null;
            passwordInput.value = "";
        };

        document.getElementById("confirmPassword").onclick = () => {
            lobby.join(pendingRoomId, passwordInput.value.trim());
            passwordModal.style.display = "none";
            pendingRoomId = null;
            passwordInput.value = "";
        };

        function renderRooms(rooms) {
            const container = document.getElementById("roomsList");
            container.innerHTML = "";

            rooms.forEach(room => {
                const btn = document.createElement("button");
                btn.className = "room";

                btn.innerHTML = `
                ${room.private ? `
                    <i><svg width="10" height="10" viewBox="0 0 10 10"><path d="M2,4Q1,4 1,5V8Q1,9 2,9H8Q9,9 9,8V5Q9,4 8,4V3A1,1 0 0 0 2,3V5H3V3A1,1 0 0 1 7,3V4Z"></path></svg></i>
                ` : ""}
                
                <div class="name">${room.name}</div>

                <div class="users">
                    <u class="user" data-active="true">
                        <svg width="6" height="6" focusable="false" aria-hidden="true" preserveAspectRatio="xMidYMid meet" class="igy igy-user" viewBox="0 0 6 6"><path d="M3 0A1 1 0 003 3 1 1 0 003 0M0 6A1 1 0 016 6"></path></svg>
                    </u>
                    <u class="user" data-active="false">
                        <svg width="6" height="6" focusable="false" aria-hidden="true" preserveAspectRatio="xMidYMid meet" class="igy igy-user" viewBox="0 0 6 6"><path d="M3 0A1 1 0 003 3 1 1 0 003 0M0 6A1 1 0 016 6"></path></svg>
                    </u>
                </div>
            `;

                btn.onclick = () => {
                    if (room.private) {
                        pendingRoomId = room.id;
                        passwordModal.style.display = "flex";
                        passwordInput.focus();
                    } else {
                        lobby.join(room.id, null);
                    }
                };

                container.appendChild(btn);
            });
        }

        const createModal = document.getElementById("createModal");

        document.getElementById("openCreateModal").onclick = () =>
            createModal.style.display = "flex";

        document.getElementById("closeCreateModal").onclick = () =>
            createModal.style.display = "none";

        document.getElementById("createRoomBtn").onclick = () => {
            const password = document.getElementById("roomPassword").value.trim();
            lobby.create(password.length > 0 ? password : null);
            createModal.style.display = "none";
        };
    </script>

</body>

</html>